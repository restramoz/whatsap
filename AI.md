INGRID: AUTONOMOUS AGENT ARCHITECTURE MANIFESTO

Version: 1.5.0 (Stable-Vector-V4)
Codename: God Tier Assistant
Timezone: Asia/Jakarta (WIB)

1. EXECUTIVE SUMMARY

Ingrid adalah agen AI hibrida yang beroperasi di atas infrastruktur Next.js 15 (App Router), didukung oleh Supabase (pgvector) untuk memori jangka panjang, dan diorkestrasi oleh LangChain. Sistem ini menggunakan arsitektur Multi-Provider AI Router yang secara dinamis memilih antara kecepatan (Groq) dan penalaran kontekstual (Gemini/OpenAI) dengan mekanisme fallback otomatis.

2. NEURAL ARCHITECTURE (TECH STACK)

A. Core Processing Unit (The Brain)

Runtime: Node.js (via Next.js Serverless Functions)

Orchestrator: LangChain.js

Primary Model (Fast Inference): llama-3.3-70b-versatile (via Groq Cloud)

Role: Menangani percakapan real-time dengan latensi <2 detik.

Secondary Model (Reasoning/Fallback): gemini-1.5-flash (via Google AI)

Role: Cadangan jika Groq mengalami rate-limit atau downtime.

Tertiary Model (Safety Net): gpt-oss:120b-cloud (via OpenRouter)

B. Memory Subsystem (The Hippocampus)

Database: Supabase (PostgreSQL 15+)

Vector Engine: pgvector extension

Embedding Model: models/text-embedding-004 (Google DeepMind)

Dimension: 768

Metric: Cosine Similarity (<=>)

Table Schema: public.chat_history

id: bigserial

content: text (User + AI dialogue)

metadata: jsonb (Stores { phoneNumber: string })

embedding: vector(768)

C. Sensory Interface (The Eyes & Ears)

Gateway: WhatsApp Web.js (Running on separate Node.js process)

Communication Protocol: REST API (POST /send) & Webhook (POST /api/webhook)

3. COGNITIVE PIPELINE (RAG WORKFLOW)

Setiap pesan yang masuk memicu alur kerja (workflow) berikut secara berurutan:

Phase 1: Input Sanitization (CRITICAL)

Sistem menerima input mentah dari WhatsApp. Sebelum diproses, input WAJIB disanitasi untuk mencegah Vector Dimension Mismatch Error (Error 400).

Rule: text.replace(/[\n\r]+/g, " ")

Reason: Model text-embedding-004 sangat sensitif terhadap karakter newline dan sering mengembalikan array kosong [] jika input tidak rata (flattened).

Phase 2: Memory Retrieval

Sistem melakukan Semantic Search ke Supabase:

SELECT content, 1 - (embedding <=> query_embedding) as similarity
FROM chat_history
WHERE metadata->>'phoneNumber' = 'USER_PHONE_NUMBER'
ORDER BY similarity DESC
LIMIT 3;


Privacy Filter: Pencarian dibatasi secara ketat berdasarkan phoneNumber pengirim.

Phase 3: Context Augmentation

Prompt disusun secara dinamis dengan menyuntikkan:

System Persona: "Ingrid, AI Assistant God Tier."

Temporal Context: Waktu server saat ini dalam zona Asia/Jakarta.

Retrieved Memory: 3 potong percakapan masa lalu yang relevan.

Phase 4: Generation & Parallel Execution

Untuk meminimalkan waktu tunggu pengguna (Wait Time), sistem melakukan forking proses:

Thread A (Priority): Mengirim balasan teks ke WhatsApp Service.

Thread B (Background): Membuat embedding dari pasangan (User Query + AI Response) dan menyimpannya ke Supabase.

4. TROUBLESHOOTING & KNOWN ISSUES

Issue: "Vector must have at least 1 dimension" (Error 400)

Cause: API Google Embedding mengembalikan array kosong saat menerima teks dengan format baris baru (newline) yang berantakan atau string kosong.

Fix: Implementasi fungsi cleanTextForEmbedding() yang menghapus semua \n dan \r sebelum request ke API.

Status: SOLVED (v1.5.0).

Issue: "Model models/embedding-001 not found" (Error 404)

Cause: Google telah mematikan akses ke model embedding legacy (v1beta).

Fix: Migrasi total ke models/text-embedding-004 dengan parameter wajib taskType: "RETRIEVAL_DOCUMENT".

Status: SOLVED (v1.5.0).

5. ENVIRONMENT VARIABLES SPECIFICATION

Sistem memerlukan variabel lingkungan berikut untuk beroperasi penuh:

Variable

Description

Criticality

NEXT_PUBLIC_SUPABASE_URL

Endpoint HTTPS Project Supabase

HIGH

SUPABASE_SERVICE_ROLE_KEY

Kunci Admin untuk Bypass RLS (Write Access)

HIGH

GEMINI_API_KEY

Untuk Embedding & Fallback Model

HIGH

GROQ_API_KEY

Untuk Primary Llama-3 Model

HIGH

OPENROUTER_API_KEY

Untuk Tertiary Fallback

MEDIUM

6. FUTURE ROADMAP

Multi-Modal Capabilities: Menambahkan kemampuan memproses gambar (Vision) menggunakan gemini-1.5-pro-vision.

Active Learning: Mekanisme feedback loop di mana pengguna bisa mengoreksi ingatan Ingrid.

Session Management: Meningkatkan "jendela konteks" jangka pendek menggunakan Redis selain memori vektor jangka panjang.

Document generated by Ingrid System Core.